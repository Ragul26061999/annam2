"use strict";exports.id=968,exports.ids=[968],exports.modules={5336:(t,e,n)=>{n.d(e,{A:()=>i});let i=(0,n(62688).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},35071:(t,e,n)=>{n.d(e,{A:()=>i});let i=(0,n(62688).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},72589:(t,e,n)=>{n.d(e,{H8:()=>u,Xj:()=>m,ZR:()=>f,gG:()=>c,ic:()=>p,ol:()=>h,pN:()=>g});var i=n(16391);let a={maxAppointmentsPerDay:30,minAdvanceBookingHours:0,maxAdvanceBookingDays:180,allowWeekendBooking:!0,emergencySlotBuffer:10,followUpGracePeriod:14,allowEmergencyBooking:!0,emergencyMaxAdvanceDays:30};async function o(t,e=a){let n=[],i=[];t.patientId||n.push("Patient ID is required"),t.doctorId||n.push("Doctor ID is required"),t.appointmentDate||n.push("Appointment date is required"),t.appointmentTime||n.push("Appointment time is required");let r=new Date(`${t.appointmentDate}T${t.appointmentTime}`),s=new Date,p=r.getDay();if(r<s&&n.push("Appointment cannot be scheduled in the past"),t.isEmergency&&e.allowEmergencyBooking)(r.getTime()-s.getTime())/864e5>e.emergencyMaxAdvanceDays&&n.push(`Emergency appointments cannot be booked more than ${e.emergencyMaxAdvanceDays} days in advance`);else{(r.getTime()-s.getTime())/864e5>e.maxAdvanceBookingDays&&n.push(`Appointments cannot be booked more than ${e.maxAdvanceBookingDays} days in advance`),e.allowWeekendBooking||0!==p&&6!==p||i.push("Weekend appointments may have limited availability");let t=r.getHours();(t<7||t>=20)&&i.push("Appointments outside 7:00 AM to 8:00 PM may have limited doctor availability")}return t.durationMinutes&&(t.durationMinutes<15||t.durationMinutes>120)&&n.push("Appointment duration must be between 15 and 120 minutes"),{isValid:0===n.length,errors:n,warnings:i}}async function r(t,e){let n=[],o=[];try{let r=new Date(`${t.appointmentDate}T${t.appointmentTime}`),s=t.durationMinutes||30,p=new Date(r.getTime()+6e4*s),l=i.ND.from("appointments").select("id, appointment_time, duration_minutes").eq("doctor_id",t.doctorId).eq("appointment_date",t.appointmentDate).in("status",["scheduled","confirmed","in_progress"]);e&&(l=l.neq("id",e));let{data:d,error:c}=await l;if(c)return n.push("Failed to check doctor availability"),{isValid:!1,errors:n,warnings:o};for(let e of d||[]){let i=new Date(`${t.appointmentDate}T${e.appointment_time}`),a=new Date(i.getTime()+6e4*(e.duration_minutes||30));(r>=i&&r<a||p>i&&p<=a||r<=i&&p>=a)&&n.push(`Doctor has a conflicting appointment at ${e.appointment_time}`)}let m=i.ND.from("appointments").select("id, appointment_time, duration_minutes").eq("patient_id",t.patientId).eq("appointment_date",t.appointmentDate).in("status",["scheduled","confirmed","in_progress"]);e&&(m=m.neq("id",e));let{data:u,error:g}=await m;if(g)return n.push("Failed to check patient availability"),{isValid:!1,errors:n,warnings:o};for(let e of u||[]){let i=new Date(`${t.appointmentDate}T${e.appointment_time}`),a=new Date(i.getTime()+6e4*(e.duration_minutes||30));(r>=i&&r<a||p>i&&p<=a||r<=i&&p>=a)&&n.push(`Patient has a conflicting appointment at ${e.appointment_time}`)}let{count:h,error:f}=await i.ND.from("appointments").select("id",{count:"exact",head:!0}).eq("doctor_id",t.doctorId).eq("appointment_date",t.appointmentDate).in("status",["scheduled","confirmed","in_progress"]);f?o.push("Could not verify daily appointment limit"):(h||0)>=a.maxAppointmentsPerDay&&n.push(`Doctor has reached the maximum daily appointment limit (${a.maxAppointmentsPerDay})`)}catch(t){console.error("Error checking appointment conflicts:",t),n.push("Failed to validate appointment conflicts")}return{isValid:0===n.length,errors:n,warnings:o}}async function s(t,e,n=a){let i=await o(t,n);if(!i.isValid)return i;let p=await r(t,e);return{isValid:i.isValid&&p.isValid,errors:[...i.errors,...p.errors],warnings:[...i.warnings,...p.warnings]}}function p(t){if(!t)return null;let e=t.match(/Token:\s*([A-Z]\d{3})/);return e?e[1]:null}async function l(){let t=new Date,e=t.getFullYear().toString(),n=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0"),o=`${e}${n}${a}`;try{let{count:t,error:e}=await i.ND.from("appointments").select("id",{count:"exact",head:!0}).like("appointment_id",`APT${o}%`);if(e)throw console.error("Error getting appointment count:",e),Error("Failed to generate appointment ID");let n=((t||0)+1).toString().padStart(4,"0");return`APT${o}${n}`}catch(t){throw console.error("Error generating appointment ID:",t),t}}async function d(t,e){try{let{count:n,error:a}=await i.ND.from("appointments").select("id",{count:"exact",head:!0}).eq("doctor_id",t).eq("appointment_date",e).in("status",["scheduled","confirmed","in_progress","completed"]);if(a)throw console.error("Error getting appointment token count:",a),Error("Failed to generate appointment token");return(n||0)+1}catch(t){throw console.error("Error generating appointment token:",t),t}}async function c(t,e){try{let n=await s(t);if(!n.isValid){let t=n.errors.join("; ");throw Error(`Appointment validation failed: ${t}`)}n.warnings.length>0&&console.warn("Appointment warnings:",n.warnings.join("; "));let{data:a}=await i.ND.from("doctors").select("id").eq("id",t.doctorId).single();if(!a)throw Error(`Doctor with ID ${t.doctorId} not found. Only registered doctors can have appointments.`);let o=await l(),r=await d(t.doctorId,t.appointmentDate),p={appointment_id:o,patient_id:t.patientId,doctor_id:t.doctorId,appointment_date:t.appointmentDate,appointment_time:t.appointmentTime,duration_minutes:t.durationMinutes||30,type:t.type,status:"scheduled",symptoms:t.chiefComplaint||t.symptoms||null,notes:t.notes?`Token: ${r} | ${t.notes}`:`Token: ${r}`,created_by:e||null},{data:c,error:m}=await i.ND.from("appointments").insert([p]).select(`
        *,
        patient:patients(id, patient_id, name, phone, email)
      `).single();if(m)throw console.error("Error creating appointment:",m),Error(`Failed to create appointment: ${m.message}`);let{data:u}=await i.ND.from("doctors").select(`
        id,
        specialization,
        qualification,
        user:users(name, phone, email)
      `).eq("id",t.doctorId).single();return{...c,doctor:u}}catch(t){throw console.error("Error creating appointment:",t),t}}async function m(t={}){try{let{page:e=1,limit:n=20,patientId:a,doctorId:o,date:r,status:s,type:p,searchTerm:l}=t,d=(e-1)*n,c=i.ND.from("appointments").select(`
        *,
        patient:patients(id, patient_id, name, phone, email)
      `,{count:"exact"});a&&(c=c.eq("patient_id",a)),o&&(c=c.eq("doctor_id",o)),r&&(c=c.eq("appointment_date",r)),s&&(c=c.eq("status",s)),p&&(c=c.eq("type",p)),l&&(c=c.or(`
        appointment_id.ilike.%${l}%,
        symptoms.ilike.%${l}%,
        chief_complaint.ilike.%${l}%,
        diagnosis.ilike.%${l}%
      `));let{data:m,error:u,count:g}=await c.range(d,d+n-1).order("appointment_date",{ascending:!1}).order("appointment_time",{ascending:!1});if(u)throw console.error("Error fetching appointments:",u),Error(`Failed to fetch appointments: ${u.message}`);return{appointments:await Promise.all((m||[]).map(async t=>{let e=null,{data:n}=await i.ND.from("doctors").select(`
            id,
            specialization,
            qualification,
            user:users(name, phone, email)
          `).eq("id",t.doctor_id).single();return n&&(e=n),{...t,doctor:e}})),total:g||0,page:e,limit:n}}catch(t){throw console.error("Error fetching appointments:",t),t}}async function u(t,e){try{let{data:n,error:a}=await i.ND.from("appointments").update({status:e}).eq("appointment_id",t).select(`
        *,
        patient:patients(id, patient_id, name, phone, email),
        doctor:doctors(
          id,
          specialization,
          user:users(name, phone, email)
        )
      `).single();if(a)throw console.error("Error updating appointment status:",a),Error(`Failed to update appointment status: ${a.message}`);return n}catch(t){throw console.error("Error updating appointment status:",t),t}}async function g(t,e,n=!1){try{let a=null,o=null,{data:r,error:s}=await i.ND.from("doctors").select(`
        *,
        user:users(name, role)
      `).eq("id",t).single();if(r?a=r:o=s,o||!a)throw console.error("Error fetching doctor:",o),Error(`Doctor not found: ${o?.message||"Doctor does not exist"}`);let{data:p,error:l}=await i.ND.from("appointments").select("appointment_time, duration_minutes").eq("doctor_id",t).eq("appointment_date",e).in("status",["scheduled","confirmed","in_progress"]);if(l)throw console.error("Error fetching existing appointments:",l),Error(`Failed to fetch existing appointments: ${l.message}`);let d=[],c=a.availability_hours;if(!c||!c.sessions||!c.availableSessions)return console.warn("Doctor has no session-based availability configured"),d;let m=new Date(e).getDay();if(!(c.workingDays||[]).includes(m))return d;if(n){for(let n=0;n<24;n++)for(let i=0;i<60;i+=30){let o=`${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`,r=p?.some(t=>{let e=t.appointment_time,n=t.duration_minutes||30,i=new Date(`2000-01-01T${e}`);i.setMinutes(i.getMinutes()+n);let a=new Date(`2000-01-01T${o}`),r=new Date(a);return r.setMinutes(r.getMinutes()+30),a<i&&r>new Date(`2000-01-01T${e}`)});d.push({date:e,time:o,available:!r,doctorId:t,doctorName:a.user?.name||"Unknown",specialization:a.specialization,isEmergency:!0})}return d}let u={morning:{start:"09:00",end:"12:00"},afternoon:{start:"14:00",end:"17:00"},evening:{start:"18:00",end:"21:00"}};return c.availableSessions.forEach(n=>{let i=c.sessions[n],o=u[n];if(!i||!o)return;let r=parseInt(i.startTime?.split(":")[0]||o.start.split(":")[0]),s=parseInt(i.endTime?.split(":")[0]||o.end.split(":")[0]),l=i.maxPatients||8,m=Math.floor((s-r)*60/30),g=Math.min(m,l),h=0;for(let i=r;i<s&&h<g;i++)for(let o=0;o<60&&h<g;o+=30){let r=`${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`,s=p?.some(t=>{let e=t.appointment_time,n=t.duration_minutes||30,i=new Date(`2000-01-01T${e}`);i.setMinutes(i.getMinutes()+n);let a=new Date(`2000-01-01T${r}`),o=new Date(a);return o.setMinutes(o.getMinutes()+30),a<i&&o>new Date(`2000-01-01T${e}`)});d.push({date:e,time:r,available:!s,doctorId:t,doctorName:a.user?.name||"Unknown",specialization:a.specialization,sessionType:n}),h++}}),d}catch(t){throw console.error("Error generating available slots:",t),t}}async function h(t,e){try{let n={status:"cancelled"};e&&(n.notes=e);let{data:a,error:o}=await i.ND.from("appointments").update(n).eq("appointment_id",t).select(`
        *,
        patient:patients(id, patient_id, name, phone, email),
        doctor:doctors(
          id, 
          doctor_id, 
          specialization, 
          department,
          user:users(name, phone, email)
        )
      `).single();if(o)throw console.error("Error cancelling appointment:",o),Error(`Failed to cancel appointment: ${o.message}`);return a}catch(t){throw console.error("Error cancelling appointment:",t),t}}async function f(t,e,n){try{let a=i.ND.from("appointments").select("id, status, appointment_date");t&&(a=a.eq("doctor_id",t)),e&&(a=a.eq("patient_id",e)),n&&(a=a.gte("appointment_date",n.start).lte("appointment_date",n.end));let{data:o,error:r}=await a;if(r)throw console.error("Error fetching appointment stats:",r),Error(`Failed to fetch appointment stats: ${r.message}`);let s=new Date().toISOString().split("T")[0],p=o?.length||0,l=o?.filter(t=>"scheduled"===t.status).length||0,d=o?.filter(t=>"completed"===t.status).length||0,c=o?.filter(t=>"cancelled"===t.status).length||0,m=o?.filter(t=>t.appointment_date===s).length||0,u=o?.filter(t=>new Date(t.appointment_date)>new Date(s)&&["scheduled","confirmed"].includes(t.status)).length||0;return{total:p,scheduled:l,completed:d,cancelled:c,todayCount:m,upcomingCount:u}}catch(t){throw console.error("Error getting appointment stats:",t),t}}},93613:(t,e,n)=>{n.d(e,{A:()=>i});let i=(0,n(62688).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])}};