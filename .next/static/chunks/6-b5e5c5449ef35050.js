"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6],{646:(t,e,n)=>{n.d(e,{A:()=>a});let a=(0,n(9946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},4861:(t,e,n)=>{n.d(e,{A:()=>a});let a=(0,n(9946).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},5339:(t,e,n)=>{n.d(e,{A:()=>a});let a=(0,n(9946).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},5549:(t,e,n)=>{n.d(e,{H8:()=>u,Xj:()=>m,ZR:()=>f,gG:()=>d,ic:()=>c,ol:()=>h,pN:()=>g});var a=n(2099);let o={maxAppointmentsPerDay:30,minAdvanceBookingHours:0,maxAdvanceBookingDays:180,allowWeekendBooking:!0,emergencySlotBuffer:10,followUpGracePeriod:14,allowEmergencyBooking:!0,emergencyMaxAdvanceDays:30};async function i(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=[],a=[];t.patientId||n.push("Patient ID is required"),t.doctorId||n.push("Doctor ID is required"),t.appointmentDate||n.push("Appointment date is required"),t.appointmentTime||n.push("Appointment time is required");let i=new Date("".concat(t.appointmentDate,"T").concat(t.appointmentTime)),r=new Date,s=i.getDay();if(i<r&&n.push("Appointment cannot be scheduled in the past"),t.isEmergency&&e.allowEmergencyBooking)(i.getTime()-r.getTime())/864e5>e.emergencyMaxAdvanceDays&&n.push("Emergency appointments cannot be booked more than ".concat(e.emergencyMaxAdvanceDays," days in advance"));else{(i.getTime()-r.getTime())/864e5>e.maxAdvanceBookingDays&&n.push("Appointments cannot be booked more than ".concat(e.maxAdvanceBookingDays," days in advance")),e.allowWeekendBooking||0!==s&&6!==s||a.push("Weekend appointments may have limited availability");let t=i.getHours();(t<7||t>=20)&&a.push("Appointments outside 7:00 AM to 8:00 PM may have limited doctor availability")}return t.durationMinutes&&(t.durationMinutes<15||t.durationMinutes>120)&&n.push("Appointment duration must be between 15 and 120 minutes"),{isValid:0===n.length,errors:n,warnings:a}}async function r(t,e){let n=[],i=[];try{let r=new Date("".concat(t.appointmentDate,"T").concat(t.appointmentTime)),s=t.durationMinutes||30,c=new Date(r.getTime()+6e4*s),l=a.ND.from("appointments").select("id, appointment_time, duration_minutes").eq("doctor_id",t.doctorId).eq("appointment_date",t.appointmentDate).in("status",["scheduled","confirmed","in_progress"]);e&&(l=l.neq("id",e));let{data:p,error:d}=await l;if(d)return n.push("Failed to check doctor availability"),{isValid:!1,errors:n,warnings:i};for(let e of p||[]){let a=new Date("".concat(t.appointmentDate,"T").concat(e.appointment_time)),o=new Date(a.getTime()+6e4*(e.duration_minutes||30));(r>=a&&r<o||c>a&&c<=o||r<=a&&c>=o)&&n.push("Doctor has a conflicting appointment at ".concat(e.appointment_time))}let m=a.ND.from("appointments").select("id, appointment_time, duration_minutes").eq("patient_id",t.patientId).eq("appointment_date",t.appointmentDate).in("status",["scheduled","confirmed","in_progress"]);e&&(m=m.neq("id",e));let{data:u,error:g}=await m;if(g)return n.push("Failed to check patient availability"),{isValid:!1,errors:n,warnings:i};for(let e of u||[]){let a=new Date("".concat(t.appointmentDate,"T").concat(e.appointment_time)),o=new Date(a.getTime()+6e4*(e.duration_minutes||30));(r>=a&&r<o||c>a&&c<=o||r<=a&&c>=o)&&n.push("Patient has a conflicting appointment at ".concat(e.appointment_time))}let{count:h,error:f}=await a.ND.from("appointments").select("id",{count:"exact",head:!0}).eq("doctor_id",t.doctorId).eq("appointment_date",t.appointmentDate).in("status",["scheduled","confirmed","in_progress"]);f?i.push("Could not verify daily appointment limit"):(h||0)>=o.maxAppointmentsPerDay&&n.push("Doctor has reached the maximum daily appointment limit (".concat(o.maxAppointmentsPerDay,")"))}catch(t){console.error("Error checking appointment conflicts:",t),n.push("Failed to validate appointment conflicts")}return{isValid:0===n.length,errors:n,warnings:i}}async function s(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,a=await i(t,n);if(!a.isValid)return a;let s=await r(t,e);return{isValid:a.isValid&&s.isValid,errors:[...a.errors,...s.errors],warnings:[...a.warnings,...s.warnings]}}function c(t){if(!t)return null;let e=t.match(/Token:\s*([A-Z]\d{3})/);return e?e[1]:null}async function l(){let t=new Date,e=t.getFullYear().toString(),n=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0"),i="".concat(e).concat(n).concat(o);try{let{count:t,error:e}=await a.ND.from("appointments").select("id",{count:"exact",head:!0}).like("appointment_id","APT".concat(i,"%"));if(e)throw console.error("Error getting appointment count:",e),Error("Failed to generate appointment ID");let n=((t||0)+1).toString().padStart(4,"0");return"APT".concat(i).concat(n)}catch(t){throw console.error("Error generating appointment ID:",t),t}}async function p(t,e){try{let{count:n,error:o}=await a.ND.from("appointments").select("id",{count:"exact",head:!0}).eq("doctor_id",t).eq("appointment_date",e).in("status",["scheduled","confirmed","in_progress","completed"]);if(o)throw console.error("Error getting appointment token count:",o),Error("Failed to generate appointment token");return(n||0)+1}catch(t){throw console.error("Error generating appointment token:",t),t}}async function d(t,e){try{let n=await s(t);if(!n.isValid){let t=n.errors.join("; ");throw Error("Appointment validation failed: ".concat(t))}n.warnings.length>0&&console.warn("Appointment warnings:",n.warnings.join("; "));let{data:o}=await a.ND.from("doctors").select("id").eq("id",t.doctorId).single();if(!o)throw Error("Doctor with ID ".concat(t.doctorId," not found. Only registered doctors can have appointments."));let i=await l(),r=await p(t.doctorId,t.appointmentDate),c={appointment_id:i,patient_id:t.patientId,doctor_id:t.doctorId,appointment_date:t.appointmentDate,appointment_time:t.appointmentTime,duration_minutes:t.durationMinutes||30,type:t.type,status:"scheduled",symptoms:t.chiefComplaint||t.symptoms||null,notes:t.notes?"Token: ".concat(r," | ").concat(t.notes):"Token: ".concat(r),created_by:e||null},{data:d,error:m}=await a.ND.from("appointments").insert([c]).select("\n        *,\n        patient:patients(id, patient_id, name, phone, email)\n      ").single();if(m)throw console.error("Error creating appointment:",m),Error("Failed to create appointment: ".concat(m.message));let{data:u}=await a.ND.from("doctors").select("\n        id,\n        specialization,\n        qualification,\n        user:users(name, phone, email)\n      ").eq("id",t.doctorId).single();return{...d,doctor:u}}catch(t){throw console.error("Error creating appointment:",t),t}}async function m(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let{page:e=1,limit:n=20,patientId:o,doctorId:i,date:r,status:s,type:c,searchTerm:l}=t,p=(e-1)*n,d=a.ND.from("appointments").select("\n        *,\n        patient:patients(id, patient_id, name, phone, email)\n      ",{count:"exact"});o&&(d=d.eq("patient_id",o)),i&&(d=d.eq("doctor_id",i)),r&&(d=d.eq("appointment_date",r)),s&&(d=d.eq("status",s)),c&&(d=d.eq("type",c)),l&&(d=d.or("\n        appointment_id.ilike.%".concat(l,"%,\n        symptoms.ilike.%").concat(l,"%,\n        chief_complaint.ilike.%").concat(l,"%,\n        diagnosis.ilike.%").concat(l,"%\n      ")));let{data:m,error:u,count:g}=await d.range(p,p+n-1).order("appointment_date",{ascending:!1}).order("appointment_time",{ascending:!1});if(u)throw console.error("Error fetching appointments:",u),Error("Failed to fetch appointments: ".concat(u.message));return{appointments:await Promise.all((m||[]).map(async t=>{let e=null,{data:n}=await a.ND.from("doctors").select("\n            id,\n            specialization,\n            qualification,\n            user:users(name, phone, email)\n          ").eq("id",t.doctor_id).single();return n&&(e=n),{...t,doctor:e}})),total:g||0,page:e,limit:n}}catch(t){throw console.error("Error fetching appointments:",t),t}}async function u(t,e){try{let{data:n,error:o}=await a.ND.from("appointments").update({status:e}).eq("appointment_id",t).select("\n        *,\n        patient:patients(id, patient_id, name, phone, email),\n        doctor:doctors(\n          id,\n          specialization,\n          user:users(name, phone, email)\n        )\n      ").single();if(o)throw console.error("Error updating appointment status:",o),Error("Failed to update appointment status: ".concat(o.message));return n}catch(t){throw console.error("Error updating appointment status:",t),t}}async function g(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{let i=null,r=null,{data:s,error:c}=await a.ND.from("doctors").select("\n        *,\n        user:users(name, role)\n      ").eq("id",t).single();if(s?i=s:r=c,r||!i)throw console.error("Error fetching doctor:",r),Error("Doctor not found: ".concat((null==r?void 0:r.message)||"Doctor does not exist"));let{data:l,error:p}=await a.ND.from("appointments").select("appointment_time, duration_minutes").eq("doctor_id",t).eq("appointment_date",e).in("status",["scheduled","confirmed","in_progress"]);if(p)throw console.error("Error fetching existing appointments:",p),Error("Failed to fetch existing appointments: ".concat(p.message));let d=[],m=i.availability_hours;if(!m||!m.sessions||!m.availableSessions)return console.warn("Doctor has no session-based availability configured"),d;let u=new Date(e).getDay();if(!(m.workingDays||[]).includes(u))return d;if(n){for(let n=0;n<24;n++)for(let a=0;a<60;a+=30){var o;let r="".concat(n.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0")),s=null==l?void 0:l.some(t=>{let e=t.appointment_time,n=t.duration_minutes||30,a=new Date("2000-01-01T".concat(e));a.setMinutes(a.getMinutes()+n);let o=new Date("2000-01-01T".concat(r)),i=new Date(o);return i.setMinutes(i.getMinutes()+30),o<a&&i>new Date("2000-01-01T".concat(e))});d.push({date:e,time:r,available:!s,doctorId:t,doctorName:(null==(o=i.user)?void 0:o.name)||"Unknown",specialization:i.specialization,isEmergency:!0})}return d}let g={morning:{start:"09:00",end:"12:00"},afternoon:{start:"14:00",end:"17:00"},evening:{start:"18:00",end:"21:00"}};return m.availableSessions.forEach(n=>{var a,o,r;let s=m.sessions[n],c=g[n];if(!s||!c)return;let p=parseInt((null==(a=s.startTime)?void 0:a.split(":")[0])||c.start.split(":")[0]),u=parseInt((null==(o=s.endTime)?void 0:o.split(":")[0])||c.end.split(":")[0]),h=s.maxPatients||8,f=Math.floor((u-p)*60/30),w=Math.min(f,h),y=0;for(let a=p;a<u&&y<w;a++)for(let o=0;o<60&&y<w;o+=30){let s="".concat(a.toString().padStart(2,"0"),":").concat(o.toString().padStart(2,"0")),c=null==l?void 0:l.some(t=>{let e=t.appointment_time,n=t.duration_minutes||30,a=new Date("2000-01-01T".concat(e));a.setMinutes(a.getMinutes()+n);let o=new Date("2000-01-01T".concat(s)),i=new Date(o);return i.setMinutes(i.getMinutes()+30),o<a&&i>new Date("2000-01-01T".concat(e))});d.push({date:e,time:s,available:!c,doctorId:t,doctorName:(null==(r=i.user)?void 0:r.name)||"Unknown",specialization:i.specialization,sessionType:n}),y++}}),d}catch(t){throw console.error("Error generating available slots:",t),t}}async function h(t,e){try{let n={status:"cancelled"};e&&(n.notes=e);let{data:o,error:i}=await a.ND.from("appointments").update(n).eq("appointment_id",t).select("\n        *,\n        patient:patients(id, patient_id, name, phone, email),\n        doctor:doctors(\n          id, \n          doctor_id, \n          specialization, \n          department,\n          user:users(name, phone, email)\n        )\n      ").single();if(i)throw console.error("Error cancelling appointment:",i),Error("Failed to cancel appointment: ".concat(i.message));return o}catch(t){throw console.error("Error cancelling appointment:",t),t}}async function f(t,e,n){try{let o=a.ND.from("appointments").select("id, status, appointment_date");t&&(o=o.eq("doctor_id",t)),e&&(o=o.eq("patient_id",e)),n&&(o=o.gte("appointment_date",n.start).lte("appointment_date",n.end));let{data:i,error:r}=await o;if(r)throw console.error("Error fetching appointment stats:",r),Error("Failed to fetch appointment stats: ".concat(r.message));let s=new Date().toISOString().split("T")[0],c=(null==i?void 0:i.length)||0,l=(null==i?void 0:i.filter(t=>"scheduled"===t.status).length)||0,p=(null==i?void 0:i.filter(t=>"completed"===t.status).length)||0,d=(null==i?void 0:i.filter(t=>"cancelled"===t.status).length)||0,m=(null==i?void 0:i.filter(t=>t.appointment_date===s).length)||0,u=(null==i?void 0:i.filter(t=>new Date(t.appointment_date)>new Date(s)&&["scheduled","confirmed"].includes(t.status)).length)||0;return{total:c,scheduled:l,completed:p,cancelled:d,todayCount:m,upcomingCount:u}}catch(t){throw console.error("Error getting appointment stats:",t),t}}}}]);