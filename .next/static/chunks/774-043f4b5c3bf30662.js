"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[774],{2099:(t,e,n)=>{n.d(e,{HW:()=>i,ND:()=>r,Ru:()=>a});let r=(0,n(5647).UU)("https://zusheijhebsmjiyyeiqq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1c2hlaWpoZWJzbWppeXllaXFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE4MjI0NDAsImV4cCI6MjA2NzM5ODQ0MH0.iwGPaOJPa6OvwX_iA1xvRt5cM72DWfd8Br1pwRTemRc"),a=async(t,e)=>{let{data:n,error:a}=await r.auth.signInWithPassword({email:t,password:e});return{data:n,error:a}},i=async()=>{let{data:{user:t}}=await r.auth.getUser();return t}},8393:(t,e,n)=>{n.d(e,{QE:()=>a,uE:()=>u,bG:()=>d,DW:()=>l});var r=n(2099);async function a(){let t=new Date,e=t.getFullYear().toString().slice(-2),n=(t.getMonth()+1).toString().padStart(2,"0");try{let t="",a=!1,i=0;for(;!a&&i<1e3;){let o=Math.floor(1e4*Math.random()).toString().padStart(4,"0");t="AH".concat(e).concat(n).concat(o);let{data:s,error:c}=await r.ND.from("patients").select("patient_id").eq("patient_id",t).single();if(c&&"PGRST116"===c.code)a=!0;else if(c)throw console.error("Error checking UHID uniqueness:",c),Error("Failed to generate UHID");i++}if(!a)throw Error("Failed to generate unique UHID after maximum attempts");return t}catch(t){throw console.error("Error generating UHID:",t),Error("Failed to generate UHID")}}async function i(t){let e="".concat(t,"@annam.com"),n="password";try{let{data:a,error:i}=await r.ND.auth.signUp({email:e,password:n,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback"),data:{role:"patient",uhid:t,email_confirm:!0}}});if(i)throw console.error("Error creating auth user:",i),Error("Failed to create authentication: ".concat(i.message));return{authUser:a.user,credentials:{email:e,password:n}}}catch(t){throw console.error("Error creating patient auth credentials:",t),t}}async function o(t,e,n){try{let a="".concat(e.firstName," ").concat(e.lastName),i=function(t){let e=new Date,n=e.getFullYear().toString(),r=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getTime().toString().slice(-4);return"BARS".concat(n).concat(r).concat(a)}(0),o=null;e.admissionDate&&(o=e.admissionTime?"".concat(e.admissionDate,"T").concat(e.admissionTime):"".concat(e.admissionDate,"T00:00:00"));let s={patient_id:t,barcode_id:i,name:a,date_of_birth:e.dateOfBirth,gender:e.gender.toLowerCase(),marital_status:e.maritalStatus||null,phone:e.phone,email:e.email||"".concat(t,"@annam.com"),address:e.address,blood_group:e.bloodGroup||null,allergies:e.allergies||null,medical_history:e.medicalHistory||null,current_medications:e.currentMedications||null,chronic_conditions:e.chronicConditions||null,previous_surgeries:e.previousSurgeries||null,admission_date:o,admission_time:e.admissionTime||null,primary_complaint:e.primaryComplaint,admission_type:e.admissionType,referring_doctor_facility:e.referringDoctorFacility||null,department_ward:e.departmentWard||null,room_number:e.roomNumber||null,guardian_name:e.guardianName||null,guardian_relationship:e.guardianRelationship||null,guardian_phone:e.guardianPhone||null,guardian_address:e.guardianAddress||null,emergency_contact_name:e.emergencyContactName||null,emergency_contact_phone:e.emergencyContactPhone||null,emergency_contact_relationship:e.emergencyContactRelationship||null,insurance_number:e.insuranceNumber||null,insurance_provider:e.insuranceProvider||null,initial_symptoms:e.initialSymptoms||null,referred_by:e.referredBy||null,user_id:n||null,status:"active"},{data:c,error:l}=await r.ND.from("patients").insert([s]).select().single();if(l)throw console.error("Error inserting patient record:",l),Error("Failed to create patient record: ".concat(l.message));return c}catch(t){throw console.error("Error inserting patient record:",t),t}}async function s(t,e,n){try{let a="".concat(n.firstName," ").concat(n.lastName),i={auth_id:t,employee_id:e,name:a,email:n.email||"".concat(e,"@annam.com"),role:"patient",phone:n.phone,address:n.address,status:"active",permissions:{patient_portal:!0,view_own_records:!0,book_appointments:!0}},{data:o,error:s}=await r.ND.from("users").insert([i]).select().single();if(s)throw console.error("Error linking auth user to patient:",s),Error("Failed to create user record: ".concat(s.message));return o}catch(t){throw console.error("Error linking auth user to patient:",t),t}}async function c(t,e){try{var n,a;if(!(null==(n=e.initialSymptoms)?void 0:n.trim())&&!(null==(a=e.primaryComplaint)?void 0:a.trim()))return null;let i="APT".concat(Date.now()),o=new Date;o.setDate(o.getDate()+1);let s={appointment_id:i,patient_id:t,appointment_date:o.toISOString().split("T")[0],appointment_time:"09:00:00",type:"consultation",status:"scheduled",symptoms:e.initialSymptoms||e.primaryComplaint,notes:"Initial consultation for newly registered patient. Primary complaint: ".concat(e.primaryComplaint)},{data:c,error:l}=await r.ND.from("appointments").insert([s]).select().single();if(l)return console.error("Error creating initial appointment:",l),null;return c}catch(t){return console.error("Error creating initial appointment:",t),null}}async function l(t,e){try{var n,r;let l=e||await a();console.log("Using UHID:",l);let{authUser:d,credentials:u}=await i(l);console.log("Created auth user:",null==d?void 0:d.id);let m=await s(d.id,l,t);console.log("Created user record:",m.id);let p=await o(l,t,m.id);if(console.log("Created patient record:",p.id),(null==(n=t.initialSymptoms)?void 0:n.trim())||(null==(r=t.primaryComplaint)?void 0:r.trim())){let e=await c(p.id,t);e&&console.log("Created initial appointment:",e.id)}return{success:!0,patient:p,uhid:l,credentials:u}}catch(t){return console.error("Error registering new patient:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error occurred"}}}async function d(t){try{let{data:e,error:n}=await r.ND.from("patients").select("\n        *,\n        users:user_id (\n          id,\n          name,\n          email,\n          role,\n          status,\n          permissions\n        ),\n        appointments:appointments(\n          id,\n          appointment_id,\n          appointment_date,\n          appointment_time,\n          type,\n          status,\n          symptoms,\n          diagnosis,\n          doctor:doctors(\n            id,\n            user:users(name, specialization)\n          )\n        ),\n        bed_allocations:bed_allocations(\n          id,\n          admission_date,\n          discharge_date,\n          admission_type,\n          status,\n          bed:beds(bed_number, room_number, bed_type),\n          doctor:doctors(\n            id,\n            user:users(name, specialization)\n          )\n        )\n      ").eq("patient_id",t).single();if(n)throw console.error("Error fetching patient with related data:",n),Error("Patient not found: ".concat(n.message));return e}catch(t){throw console.error("Error fetching patient with related data:",t),t}}async function u(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let{page:e=1,limit:n=20,status:a,searchTerm:i}=t,o=(e-1)*n,s=r.ND.from("patients").select("\n        *,\n        users:user_id (\n          id,\n          name,\n          email,\n          role,\n          status,\n          permissions\n        )\n      ",{count:"exact"});a&&(s=s.eq("status",a)),i&&(s=s.or("name.ilike.%".concat(i,"%,patient_id.ilike.%").concat(i,"%,phone.ilike.%").concat(i,"%")));let{data:c,error:l,count:d}=await s.range(o,o+n-1).order("created_at",{ascending:!1});if(l)throw console.error("Error fetching patients:",l),Error("Failed to fetch patients: ".concat(l.message));return{patients:c||[],total:d||0,page:e,limit:n}}catch(t){throw console.error("Error fetching patients:",t),t}}}}]);